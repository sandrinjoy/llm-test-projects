<!DOCTYPE html>
<html>
<head>
    <title>Twitch Vote Counter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1f1f1f;
            color: white;
        }
        .container {
            background-color: #333;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        #connectBtn { background-color: #6441a5; color: white; }
        #startBtn { background-color: #2ecc71; }
        #endBtn { background-color: #e74c3c; }
        #restartBtn { background-color: #f39c12; }
        .vote-count {
            display: flex;
            justify-content: space-around;
            font-size: 24px;
            margin: 20px 0;
        }
        #chatContainer {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #555;
            padding: 10px;
            border-radius: 5px;
        }
        .message {
            margin: 5px 0;
            padding: 5px;
            background-color: #444;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <input type="text" id="channel" placeholder="Enter Twitch channel">
        <button id="connectBtn">Connect</button>
        <div id="status">Not connected</div>
    </div>

    <div class="container">
        <div class="buttons">
            <button id="startBtn">Start Voting</button>
            <button id="endBtn">End Voting</button>
            <button id="restartBtn">Restart</button>
        </div>

        <div class="vote-count">
            <div>Vote 1: <span id="vote1">0</span></div>
            <div>Vote 2: <span id="vote2">0</span></div>
        </div>
    </div>

    <div class="container">
        <h3>Chat Activity</h3>
        <div id="chatContainer"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/tmi.js@1.8.5/dist/tmi.min.js"></script>
    <script>
        let client = null;
        let isCounting = false;
        let vote1Count = 0;
        let vote2Count = 0;

        document.getElementById('connectBtn').addEventListener('click', connectToChat);
        document.getElementById('startBtn').addEventListener('click', startCounting);
        document.getElementById('endBtn').addEventListener('click', endCounting);
        document.getElementById('restartBtn').addEventListener('click', restartCounting);

        function connectToChat() {
            const channel = document.getElementById('channel').value.toLowerCase();
            if (!channel) return;

            if (client) {
                client.disconnect();
            }

            client = new tmi.Client({
                channels: [channel]
            });

            client.connect().then(() => {
                updateStatus(`Connected to ${channel}`);
            }).catch(err => {
                updateStatus('Connection error: ' + err);
            });

            client.on('message', (channel, tags, message, self) => {
                if (!isCounting) return;

                const chatContainer = document.getElementById('chatContainer');
                const msgElement = document.createElement('div');
                msgElement.className = 'message';
                msgElement.textContent = `${tags.username}: ${message}`;
                chatContainer.appendChild(msgElement);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                const vote = message.match(/[^1-2]*(1|2)/i);
                if (vote) {
                    if (vote[1] === '1') {
                        vote1Count++;
                        document.getElementById('vote1').textContent = vote1Count;
                    } else if (vote[1] === '2') {
                        vote2Count++;
                        document.getElementById('vote2').textContent = vote2Count;
                    }
                }
            });
        }

        function startCounting() {
            isCounting = true;
            updateStatus('Voting started!');
        }

        function endCounting() {
            isCounting = false;
            updateStatus('Voting ended');
        }

        function restartCounting() {
            vote1Count = 0;
            vote2Count = 0;
            document.getElementById('vote1').textContent = '0';
            document.getElementById('vote2').textContent = '0';
            document.getElementById('chatContainer').innerHTML = '';
            isCounting = true;
            updateStatus('Voting restarted');
        }

        function updateStatus(text) {
            document.getElementById('status').textContent = text;
        }
    </script>
</body>
</html>